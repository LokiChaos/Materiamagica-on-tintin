#!/usr/bin/env bash

# tmux Server and Session names
TSESSION="MM"
TSERVER="ttGame"
TARGS=""
TINTINDIR=~/.tt

# Forward the -d argument to tmux
if [ "$1" == "-d" ]; then
	TARGS+=" -d"
fi

spawn_tmux(){
	cd ${TINTINDIR}
	echo "Session ${TSESSION} does not exist. Creating."
	tmux -L ${TSERVER} new-session -d -s ${TSESSION} -c ${TINTINDIR} "tt++ -G init.tt"
	tmux -L ${TSERVER} source-file etc/tmux.conf
	tmux -L ${TSERVER} source-file etc/tmux.client.conf
	return 0
}

attach_tmux(){
	tmux -L ${TSERVER} attach ${TARGS} -t ${TSESSION}
	return 0
}

# Check if the session exists, if it does now, spawn the tmux session
if [ $(tmux -L ${TSERVER} ls 2>/dev/null | grep -c "^${TSESSION}:") = 0 ]; then
	spawn_tmux
fi

# In any case, attach the existing or newly created tmux session
attach_tmux

exit 0
